{% extends "bootstrap/base.html" %}

{% block title %}旅游行程宝{% endblock %}
{% block head %}
    {{ super() }}
    <style type="text/css">
        .list-group-item-separate {
            margin-bottom: 8px;
        }
        html,body{
                height: 100%;
                margin: 0;
                padding: 0;
                overflow-y: hidden;
        }
    </style>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="application/javascript" src="../static/dataapi.js"></script>
    <script>

        function do_addDay(proId) {
            len = $("#listDays a").length+1;
            data = {"daynum":len,"proId":proId}
            var url = "/do_addDay";
            $.post(url,data,function(id){
                if(id>0){
                    strDayDec = "第"+len+"天";
                    dayId = "day"+id;
                    tabId = "tab"+id;
                    strElement = '<a id="'+dayId+'" href="#'+tabId+'" class="list-group-item list-group-item-nav text-center active" data-toggle="tab" >'+strDayDec+
                                    '<span class="glyphicon glyphicon-trash" style="float: right;" onclick="do_delDay(\''+id+'\')"></span>'+
                                    '<span class="center-block " style="overflow: hidden;text-overflow:ellipsis;white-space: nowrap; " >拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨</span>'+
                                 '</a>';
                    $('#listDays a').removeClass('active');
                    $("#listDays").append(strElement);

                    strElement = '<div class="tab-pane fade in active" id="'+tabId+'" value="'+id+'">'+
                                    '<h4 style="padding-left: 20px;" ><span class="glyphicon glyphicon-calendar"></span>   '+strDayDec+'</h4>'+
                                    '<div class="list-group" style="padding-left: 0px;padding-right: 5px;margin-bottom:0px;width: 100%;" >'+
                                    '</div>'+
                                 '</div>';
                    $('#tabContent div').removeClass('active');
                    $("#tabContent").append(strElement);
                }else{
{#                 警告删除失败#}
                }
            });



        }

        function do_delDay(dayId) {
            data = {"dayId":dayId}
            var url = "/do_delDay";
            $.post(url,data,function(reslut){
                if(reslut>=0){
                    $("#day"+dayId).remove();
                    $("#tab"+dayId).remove();
                }
                else{
{#                    警告删除失败#}
                }
            });
        }

        function get_activeDayID() {
            dayId =  $("#tabContent .tab-pane.active:first").attr("value");
            return dayId;
        }

        function do_addPoint(tempPointId) {
            dayID = get_activeDayID();
            pName = $("#"+tempPointId+" h4.list-group-item-heading:first").text();
            pDec = $("#"+tempPointId+" p.list-group-item-text:first").text();
            data = {"dayId":dayID, "name":pName, "event": pDec}
            var url = "/do_addPoint";
            $.post(url,data,function(pointId){
                if(pointId<=0){
{#                  警告添加点失败#}
                    return;
                }
                temp = pointId;
                decId = "dec"+temp;
                itemId = "item"+temp;
                strElement =  '<a id="'+itemId+'" value="'+pointId+'"  href="#" class="list-group-item list-group-item-separate" >'+
                                    '<span class="glyphicon glyphicon-trash" style="float: right;margin-right: 10px" onclick="do_delPoint(\''+itemId+'\')" ></span>'+
                                    '<span class="glyphicon glyphicon-edit"  style="float: right;margin-right: 20px" onclick="do_editDec(\''+decId+'\')" ></span>'+
                                    '<h4 class="list-group-item-heading">'+pName+'</h4>'+
                                    '<p id="'+decId+'" class="list-group-item-separate" style="display: none;">'+pDec+'</p>'+
                                    '<div class="list-group-item-text" style="margin-bottom: 20px;">'+
                                        '<span class="glyphicon glyphicon-dashboard" style="float: left;margin-left: 15px">300米</span >'+
                                        '<span class="glyphicon glyphicon-time" style="float: left;margin-left: 15px">5分钟</span>'+
                                        '<span class="glyphicon glyphicon-edit" style="float: left;margin-left: 15px" data-toggle="modal" data-target="#editTrafficModal" onclick="do_eidtPointJT(\''+temp+'\')" >编辑交通</span>'+
                                    '</div>'+
                               '</a>';
                $("#tabContent .tab-pane.active:first > div.list-group:first").append(strElement);
            });
        }

        function do_delPoint(itemid) {
            pointId = $("#"+itemid).attr("value");
            data = {"pointId":pointId}
            var url = "/do_delPoint";
            $.post(url,data,function(reslut){
                if(reslut<=0){
{#                  警告删除失败#}
                    return;
                }
                $("#"+itemid).remove();
            });
        }

        function do_editDec(decId) {
            if($("#"+decId).is(':hidden')){
                $("#"+decId).show();
            }else{
                $("#"+decId).hide();
            }
        }
        var nowPointID;
        var nowJTFS="巴士";
        var nowZDYtype="";
        function do_PointTLSL(JTFS){
            nowJTFS=JTFS;
            //alert(nowJTFS);
        }
        function do_eidtPointJT(itemid){
            nowPointID =itemid;
        }
         function do_ZDYtype(item){
             $("#myZDYModalLabel").empty();
             $("#myZDYModalLabel").append(item);
            nowZDYtype =item;
        }
        function do_savePointTL() {
{#            do_travelError();#}
            var url = "/do_editPoint";
            var params = $("#formPointTL").serializeArray();
            var data = {};
            data['id'] =nowPointID;
            data['transport'] =nowJTFS;
            for( x in params ){
                //alert(params[x].name+" "+params[x].value);
                data[params[x].name] = params[x].value;
             }
            $.post(url,data,function(result){
                //alert(result);
               if (result <= 0){
                   alert("修改失败");
               } else {
                   // window.location.href="/seach/"+result['val'];
                   if($("#editTrafficModal").is(':hidden')){
                        $("#editTrafficModal").modal('show');
                    }else{
                        $("#editTrafficModal").modal('hide');
                    }
               }
            });
        }
        function do_saveBigPointTL() {
{#            do_travelError();#}
            var url = "/do_addPointBJ";
            var params = $("#formBigPointTL").serializeArray();
            var data = {};
            data['dayId'] =get_activeDayID();
            data['tptrainsp'] =nowJTFS;
             data['type'] =nowZDYtype;
            for( x in params ){
                //alert(params[x].name+" "+params[x].value);
                data[params[x].name] = params[x].value;
             }
            $.post(url,data,function(result){
               if (result > 0){
                   //lzh-大交通成功回调
                    //lzh-大交通成功回调
                   if($("#editJDTrafficModal").is(':hidden')){
                        $("#editJDTrafficModal").modal('show');
                    }else{
                        $("#editJDTrafficModal").modal('hide');
                    }
               } else {
                   alert("添加失败");
               }
            });
        }
        function do_saveZXDTL() {
{#            do_travelError();#}
            var url = "/do_addPoint";
            var params = $("#formZDYTL").serializeArray();
            var data = {};
            data['dayId'] =get_activeDayID();
            data['type'] =nowZDYtype;
            for( x in params ){
                //alert(params[x].name+" "+params[x].value);
                data[params[x].name] = params[x].value;
             }
            $.post(url,data,function(result){
               if (result > 0){
                   //lzh-自定义添加成功回调
                    //lzh-自定义添加成功回调
                   if($("#editZDYModal").is(':hidden')){
                        $("#editZDYModal").modal('show');
                    }else{
                        $("#editZDYModal").modal('hide');
                    }
               } else {
                   alert("添加失败");
               }
            });
        }
        function do_saveDayBZ(){
            var url = "/do_editDay";
            var params = $("#formDayBZ").serializeArray();
            var data = {};
            data['id'] =get_activeDayID();;
            for( x in params ){
                //alert(params[x].name+" "+params[x].value);
                data[params[x].name] = params[x].value;
             }
            $.post(url,data,function(result){
                //alert(result);
               if (result <= 0){
                   alert("修改失败");
               } else {
                   // window.location.href="/seach/"+result['val'];
                   if($("#editDayModal").is(':hidden')){
                        $("#editDayModal").modal('show');
                    }else{
                        $("#editDayModal").modal('hide');
                    }
               }
            });
        }


    </script>
{% endblock %}

{% block navbar %}
{#    <div class="container-fluid" >#}
        <div class="navbar navbar-fixed-top navbar-inverse" role="navigation" >
            <div class="navbar-header">
                <a class="navbar-brand" href="#">自助游行程宝</a>
            </div>
            <ul class="nav navbar-nav">
                <li id="liViewTravel" ><a href="/view" ><span class="glyphicon glyphicon-tags"></span> 我的行程</a></li>
            </ul>
        </div>
{#    </div>#}
{% endblock %}

{% block content %}
    <div class="container-fluid"  style="padding-top: 45px;padding-bottom:5px;height: 100%;">
        <div id="createTravel" class="row" style="padding-left: 5px;padding-top: 5px;height: 100%">
            <div class="col-xs-6 col-md-7" style="padding-top: 10px;padding-left: 0px;padding-right: 5px;height: 100%;">
                <div class="panel panel-default " style="height: 100%;" >
                    <div class="panel-heading" style="padding: 0px;">
                        <div class="navbar navbar-default" role="navigation" style="margin-bottom: 0px;border: 0px;">
                            <div class="navbar-header">
                                <a class="navbar-brand" href="#">城市</a>
                            </div>
                            <ul class="nav navbar-nav">
                                <li class="active" onclick="pointclick()"><a  href="#camera"><span class="glyphicon glyphicon-camera"></span> 景点</a></li>
                                <li onclick="hotelclick()"><a href="#support"><span class="glyphicon glyphicon-home"></span> 酒店</a></li>
                                <form class="navbar-form navbar-left" role="search">
                                    <div class="input-group">
                                      <input id="apitxtin" type="text" class="form-control" placeholder="输入查询内容">
                                      <span class="input-group-btn">
                                        <button class="btn btn-default" type="button">查询</button>
                                      </span>
                                    </div>
                                </form>
                            </ul>
                        </div>
                    </div>
                    <div id="dipIn" class="list-group" style="padding-left: 0px;padding-right: 0px;overflow-y:auto;max-height: 90%;">
                       <a id="10083" href="#" class="list-group-item" >
                            <div class="media">
                               <div class="media-left media-middle">
                                    <img src="" style="width: 85px;height: 85px;">
                                </div>
                                <div class="media-body media-middle">
                                    <h4 class="list-group-item-heading">玛吉阿米</h4>
                                    <p class="list-group-item-text" >八廓街上东南转角处是有名的玛吉阿米餐厅八廓街上东南转角处是有名的玛吉阿米餐厅八廓街上东南转角处是有名的玛吉阿米餐厅八廓街上东南转角处是有名的玛吉阿米餐厅八廓街上。</p>
                                </div>
                               <div class="media-right media-middle">
                                    <span class="badge" style="width: 50px;margin: 10px 50px;border-radius: 50px;" onclick="do_addPoint('10083')"><h4>+</h4></span>
                                </div>
                            </div>
                       </a>
                    </div>
                    <div id="dipFYIn" style="text-align:right;" ></div>
                </div>
            </div>
            <div class="col-xs-6  col-md-5 " style="padding-top: 10px;padding-left: 0px;padding-right: 5px;height: 100%;" >
                <div class="panel panel-default " style="height: 100%;" >
                    <div class="panel-heading" style="padding: 0px;">
                        <span class="btn btn-default" style="margin: 8px;"  >西藏9日游</span>
                        <button type="button" class="btn btn-default" style="margin: 8px;float: right;" data-toggle="modal" > 完成查看 </button>
                    </div>
                    <div style="padding: 0px;height: 100%;">
                        <div class="col-xs-4 col-md-2" style="padding: 0px;height: 100%;border-right: 1px solid #ddd;" >
                            <ul id="listDays" class='list-group list-group-flush' style="padding: 5px;margin-bottom:10px;overflow-y:auto;max-height: 90%;" >
                                <a  href="#" class="list-group-item list-group-item-nav text-center" data-toggle="tab" >
                                    第1天
                                    <span class="glyphicon glyphicon-trash" style="float: right;"></span>
                                    <span class="center-block " style="overflow: hidden;text-overflow:ellipsis;white-space: nowrap; " >
                                        拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨拉萨
                                    </span>
                                </a>
                                {% for item in items %}

                                {% endfor %}
                            </ul>
                            <span type="button" class="btn btn-default center-block" style="margin: 5px;" onclick="do_addDay({{ proId }})"> 加一天 </span>
                        </div>
                        <div class="col-xs-8 col-md-10" style="padding-left: 5px;padding-right: 0px;height: 100%;">
                            <div id="tabContent" class='tab-content' style="overflow-y:auto;max-height: 90%;">
                            </div>
                            <p style="margin-left: 15px;margin-top: 10px;">添加自定义
                                <a href="javascript:;" data-toggle="modal" data-target="#editZDYModal" onclick="do_ZDYtype('自定义-景点')">景点</a>、
                                <a data-toggle="modal" data-target="#editZDYModal" onclick="do_ZDYtype('自定义-餐馆')">餐馆</a>、
                                <a data-toggle="modal" data-target="#editJDTrafficModal"  onclick="do_ZDYtype('自定义-交通')">交通</a>、
                                <a data-toggle="modal" data-target="#editZDYModal" onclick="do_ZDYtype('自定义-酒店')">酒店</a>、
                                <a data-toggle="modal" data-target="#editDayModal" >备注</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editTrafficModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
        <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> &times; </button>
                <h4 class="modal-title" id="myModalLabel">编辑交通</h4>
              </div>
              <div class="modal-body">
                       <ul id="pointTLTab" class="nav nav-tabs">
                            <li  class="active"  onclick="do_PointTLSL('巴士')"><a href="#TRbs" data-toggle="tab" name="巴士" ><img src="../static/img/bs.png" height="30" width="30"/></a></li>
                            <li onclick="do_PointTLSL('的士')"><a href="#TRds" data-toggle="tab" name="的士" > <img src="../static/img/ds.png" height="30" width="30"/></a></li>
                            <li onclick="do_PointTLSL('火车')"><a href="#TRhc" data-toggle="tab" name="火车" > <img src="../static/img/hc.png" height="30" width="30"/></a></li>
                            <li onclick="do_PointTLSL('地铁')"><a href="#TRdt" data-toggle="tab" name="地铁" > <img src="../static/img/dt.png" height="30" width="30"/></a></li>
                        </ul>
                          <form id="formPointTL" class="bs-example bs-example-form" role="form">
                                <div class="input-group ">
                                    <span class="input-group-addon">交通时间</span>
                                    <input id="formPointTLText" type="text" required="true" class="form-control" name="trtime" placeholder="输入交通时间">
                                </div>
                                    <span class="help-block"></span>
                                <div class="input-group">
                                    <span class="input-group-addon">交通备注</span>
                                        <textarea id="formPointTLTextArea" rows="3" class="form-control" name="trevent" placeholder="输入交通备注"></textarea>
                                </div>
                           </form>
              </div>
                 <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="do_savePointTL()" >提交更改</button>
                </div>
              </div>
          </div>
        </div>

    <div class="modal fade" id="editZDYModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
        <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> &times; </button>
                <h4 class="modal-title" id="myZDYModalLabel">编辑交通</h4>
              </div>
              <div class="modal-body">
                          <form id="formZDYTL" class="bs-example bs-example-form" role="form">
                                <div class="input-group ">
                                    <span class="input-group-addon">名称</span>
                                    <input id="formPointTLText" type="text" required="true" class="form-control" name="name" placeholder="输入名称">
                                </div>
                                    <span class="help-block"></span>
                                <div class="input-group">
                                    <span class="input-group-addon">备注</span>
                                        <textarea id="formPointTLTextArea" rows="3" class="form-control" name="event" placeholder="输入备注"></textarea>
                                </div>
                           </form>
              </div>
                 <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="do_saveZXDTL()" >提交更改</button>
                </div>
              </div>
          </div>
        </div>
    <div class="modal fade" id="editDayModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
        <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> &times; </button>
                <h4 class="modal-title" id="myDayModalLabel">编辑当天备注</h4>
              </div>
              <div class="modal-body">
                          <form id="formDayBZ" class="bs-example bs-example-form" role="form">
                                    <span class="help-block"></span>
                                <div class="input-group">
                                    <span class="input-group-addon">备注</span>
                                        <textarea id="formPointTLTextArea" rows="3" class="form-control" name="dayevent" placeholder="输入备注"></textarea>
                                </div>
                           </form>
              </div>
                 <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="do_saveDayBZ()" >提交更改</button>
                </div>
              </div>
          </div>
        </div>

    <div class="modal fade" id="editJDTrafficModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
        <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> &times; </button>
                <h4 class="modal-title" id="myModalLabel">编辑城际交通</h4>
              </div>
              <div class="modal-body">
                     <ul id="pointBigTLTab" class="nav nav-tabs">
                        <li  class="active"  onclick="do_PointTLSL('巴士')"><a href="#TRbs" data-toggle="tab" name="巴士" ><img src="../static/img/bs.png" height="30" width="30"/></a></li>
                        <li onclick="do_PointTLSL('的士')"><a href="#TRds" data-toggle="tab" name="的士" > <img src="../static/img/ds.png" height="30" width="30"/></a></li>
                        <li onclick="do_PointTLSL('火车')"><a href="#TRhc" data-toggle="tab" name="火车" > <img src="../static/img/hc.png" height="30" width="30"/></a></li>
                        <li onclick="do_PointTLSL('飞机')"><a href="#TRdt" data-toggle="tab" name="飞机" > <img src="../static/img/fj.png" height="30" width="30"/></a></li>
                    </ul>
                      <form id="formBigPointTL" class="bs-example bs-example-form" role="form">
                            <table style="width:100%;height:100%;border-spacing:10px;cellspacing:10px" >
                            <tr>
                                <td>出发城市</td>
                                <td><input id="formPointTLText" type="text" required="true" class="form-control" name="stratc" placeholder="输入出发城市"></td>
                                <td>到达城市</td>
                                <td><input id="formPointTLText" type="text" required="true" class="form-control" name="endc" placeholder="输入到达城市"></td>
                            </tr>
                            <tr>
                                <td>出发站点</td>
                                <td><input id="formPointTLText" type="text" required="true" class="form-control" name="stratp" placeholder="输入出发站点"></td>
                                <td>到达站点</td>
                                <td><input id="formPointTLText" type="text" required="true" class="form-control" name="endp" placeholder="输入到达站点"></td>
                            </tr>
                            <tr>
                                <td>出发时间</td>
                                <td><input id="formPointTLText" type="text" required="true" class="form-control" name="stratt" placeholder="输入出发时间"></td>
                                <td>到达时间</td>
                                <td><input id="formPointTLText" type="text" required="true" class="form-control" name="endt" placeholder="输入到达时间"></td>
                            </tr>
                             <tr>
                                 <td>车次</td>
                                <td><input id="formPointTLText" type="text" required="true" class="form-control" name="tptrain" placeholder="输入车次"></td>
                            </tr>
                            </table>
                                <span class="input-group-addon">交通备注</span>
                                <textarea id="formPointTLTextArea" rows="3" class="form-control" name="tptrainevent" placeholder="输入交通备注"></textarea>
                       </form>
              </div>
                 <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="do_saveBigPointTL()" >提交更改</button>
                </div>
              </div>
          </div>
        </div>

{% endblock %}